From 065045e00b3d3faf94a10585ef914c1827819715 Mon Sep 17 00:00:00 2001
From: Emmanuele Bassi <ebassi@gnome.org>
Date: Tue, 8 Aug 2017 13:31:16 +0100
Subject: [PATCH 1/1] Conditionally build documentation

In order to avoid the gtk-doc dependency, we need to optionally disable
documentation.
---
 configure         | 4 +++-
 meson.build       | 4 +++-
 meson_options.txt | 1 +
 3 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/configure b/configure
index fe3af96..80b0f19 100755
--- a/configure
+++ b/configure
@@ -73,6 +73,7 @@ while (($# > 0)); do
 	--disable-argyllcms-sensor) enable_argyllcms_sensor='-Denable-argyllcms-sensor=false';;
 	--disable-installed-tests) enable_installed_tests='-Denable-installed-tests=false';;
 	--disable-man) enable_man='-Denable-man=false';;
+	--disable-gtk-doc) enable_docs='-Denable-docs=false';;
 	*) echo -e "\e[1;33mINFO\e[0m: Ignoring unknown option '$1'";;
     esac
     shift
@@ -118,7 +119,7 @@ echo "  libdir:...... ${libdir}"
 echo "  mandir:...... ${mandir}"
 echo "  includedir:.. ${includedir}"
 echo "  additional:.."
-echo "    - ${enable_print_profiles} ${enable_argyllcms_sensor} ${enable_bash_completion} ${enable_installed_tests} ${enable_man}"
+echo "    - ${enable_print_profiles} ${enable_argyllcms_sensor} ${enable_bash_completion} ${enable_installed_tests} ${enable_man} ${enable_docs}"
 
 exec ${MESON} \
 	--prefix=${prefix} \
@@ -135,6 +136,7 @@ exec ${MESON} \
 	${enable_bash_completion} \
 	${enable_installed_tests} \
 	${enable_man} \
+	${enable_docs} \
 	${srcdir}
 
 # vim: ai ts=8 noet sts=2 ft=sh
diff --git a/meson.build b/meson.build
index 5c3d32c..7dec1d9 100644
--- a/meson.build
+++ b/meson.build
@@ -236,7 +236,9 @@ subdir('po')
 # this needs libcolord
 subdir('client')
 subdir('contrib')
-subdir('doc')
+if get_option('enable-docs')
+  subdir('doc')
+endif
 
 # this needs client/cd-create-profile
 subdir('data')
diff --git a/meson_options.txt b/meson_options.txt
index 21d3735..2904da5 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -10,3 +10,4 @@ option('enable-tests', type : 'boolean', value : true, description : 'Build self
 option('enable-installed-tests', type : 'boolean', value : false, description : 'Install tests')
 option('with-daemon-user', type : 'string', value : 'root', description : 'User for running the colord daemon')
 option('enable-man', type : 'boolean', value : true, description : 'Generate man pages')
+option('enable-docs', type : 'boolean', value : true, description : 'Generate documentation')
-- 
2.13.3

