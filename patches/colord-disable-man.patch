From 382280a2b75ead831c199aaa5ab6e590d1e8599e Mon Sep 17 00:00:00 2001
From: Emmanuele Bassi <ebassi@gnome.org>
Date: Mon, 31 Jul 2017 16:21:03 +0100
Subject: [PATCH] Conditionally generate man pages

Not all build environments are interested in man pages, or are willing
to install docbook2man and its dependencies in order to generate man
pages.
---
 configure         | 4 +++-
 meson.build       | 4 +++-
 meson_options.txt | 1 +
 3 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/configure b/configure
index 99fdb95..fe3af96 100755
--- a/configure
+++ b/configure
@@ -72,6 +72,7 @@ while (($# > 0)); do
 	--disable-bash-completion) enable_bash_completion='-Denable-bash-completion=false';;
 	--disable-argyllcms-sensor) enable_argyllcms_sensor='-Denable-argyllcms-sensor=false';;
 	--disable-installed-tests) enable_installed_tests='-Denable-installed-tests=false';;
+	--disable-man) enable_man='-Denable-man=false';;
 	*) echo -e "\e[1;33mINFO\e[0m: Ignoring unknown option '$1'";;
     esac
     shift
@@ -117,7 +118,7 @@ echo "  libdir:...... ${libdir}"
 echo "  mandir:...... ${mandir}"
 echo "  includedir:.. ${includedir}"
 echo "  additional:.."
-echo "    - ${enable_print_profiles} ${enable_argyllcms_sensor} ${enable_bash_completion} ${enable_installed_tests}"
+echo "    - ${enable_print_profiles} ${enable_argyllcms_sensor} ${enable_bash_completion} ${enable_installed_tests} ${enable_man}"
 
 exec ${MESON} \
 	--prefix=${prefix} \
@@ -133,6 +134,7 @@ exec ${MESON} \
 	${enable_argyllcms_sensor} \
 	${enable_bash_completion} \
 	${enable_installed_tests} \
+	${enable_man} \
 	${srcdir}
 
 # vim: ai ts=8 noet sts=2 ft=sh
diff --git a/meson.build b/meson.build
index ba08e0c..9d85e8b 100644
--- a/meson.build
+++ b/meson.build
@@ -242,7 +242,9 @@ subdir('doc')
 subdir('data')
 
 # this needs data/profiles/*.icc
-subdir('man')
+if get_option('enable-man')
+  subdir('man')
+endif
 subdir('policy')
 subdir('rules')
 subdir('src')
diff --git a/meson_options.txt b/meson_options.txt
index 1a49d0d..21d3735 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -9,3 +9,4 @@ option('enable-print-profiles', type : 'boolean', value : false, description : '
 option('enable-tests', type : 'boolean', value : true, description : 'Build self tests')
 option('enable-installed-tests', type : 'boolean', value : false, description : 'Install tests')
 option('with-daemon-user', type : 'string', value : 'root', description : 'User for running the colord daemon')
+option('enable-man', type : 'boolean', value : true, description : 'Generate man pages')
-- 
2.13.3

