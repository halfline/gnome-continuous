From fe06b3cb62788eb0a0607276c54444f49b346d76 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Javier=20Jard=C3=B3n?= <jjardon@gnome.org>
Date: Wed, 15 Feb 2017 20:55:37 +0000
Subject: [PATCH 4/5] mozjs38-shell-version

Add major version to shell and js-config filenames.
Author: Rico Tzschichholz <ricotz@ubuntu.com>
Forwarded: no
Last-Update: 2014-10-29
---
 js/src/Makefile.in  |  3 +++
 js/src/configure    |  5 +++++
 js/src/configure.in | 13 +++++--------
 3 files changed, 13 insertions(+), 8 deletions(-)

diff --git a/js/src/Makefile.in b/js/src/Makefile.in
index 92469a67..fad5f0fc 100644
--- a/js/src/Makefile.in
+++ b/js/src/Makefile.in
@@ -208,6 +208,9 @@ endif
 SCRIPTS = $(JS_CONFIG_NAME)
 SDK_BINARY = $(JS_CONFIG_NAME)
 
+$(JS_CONFIG_NAME): js-config
+	cp $^ $@
+
 $(LIBRARY_NAME).pc: js.pc
 	cp $^ $@
 
diff --git a/js/src/configure b/js/src/configure
index b266bc16..685bcdc1 100755
--- a/js/src/configure
+++ b/js/src/configure
@@ -1696,8 +1696,13 @@ MOZJS_MINOR_VERSION=`echo $MOZILLA_VERSION | sed "s|^[0-9]*\.\([0-9]*\).*|\1|"`
 MOZJS_PATCH_VERSION=`echo $MOZILLA_VERSION | sed "s|^[0-9]*\.[0-9]*[^0-9]*||"`
 IS_ALPHA=`echo $MOZILLA_VERSION | grep '[ab]'`
 
+if test -n "$JS_STANDALONE"; then
+JS_SHELL_NAME=js$MOZJS_MAJOR_VERSION
+JS_CONFIG_NAME=js$MOZJS_MAJOR_VERSION-config
+else
 JS_SHELL_NAME=js
 JS_CONFIG_NAME=js-config
+fi
 
 
 if test -n "$IS_ALPHA"; then
diff --git a/js/src/configure.in b/js/src/configure.in
index 534d2cea..a10bc77d 100644
--- a/js/src/configure.in
+++ b/js/src/configure.in
@@ -252,16 +252,13 @@ MOZJS_MINOR_VERSION=`echo $MOZILLA_VERSION | sed "s|^[0-9]*\.\([0-9]*\).*|\1|"`
 MOZJS_PATCH_VERSION=`echo $MOZILLA_VERSION | sed "s|^[0-9]*\.[0-9]*[^0-9]*||"`
 IS_ALPHA=`echo $MOZILLA_VERSION | grep '[ab]'`
 
-dnl XXX in a temporary bid to avoid developer anger at renaming files
-dnl XXX before "js" symlinks exist, don't change names.
-dnl
-dnl if test -n "$JS_STANDALONE"; then
-dnl JS_SHELL_NAME=js$MOZJS_MAJOR_VERSION
-dnl JS_CONFIG_NAME=js$MOZJS_MAJOR_VERSION-config
-dnl else
+if test -n "$JS_STANDALONE"; then
+JS_SHELL_NAME=js$MOZJS_MAJOR_VERSION
+JS_CONFIG_NAME=js$MOZJS_MAJOR_VERSION-config
+else
 JS_SHELL_NAME=js
 JS_CONFIG_NAME=js-config
-dnl fi
+fi
 
 changequote([,])
 if test -n "$IS_ALPHA"; then
-- 
2.11.1

